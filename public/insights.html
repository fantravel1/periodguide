<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="description" content="PeriodGuide Insights Dashboard — Visualize your cycle patterns, symptom trends, and correlations. Non-diagnostic pattern detection to help you understand your body better.">
  <meta name="keywords" content="period insights, cycle patterns, menstrual trends, symptom tracking, cycle analytics, period data, mood trends, pain patterns">
  <meta name="author" content="PeriodGuide">
  <meta name="robots" content="index, follow">
  <meta name="theme-color" content="#E85D75">

  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="Insights Dashboard — PeriodGuide">
  <meta property="og:description" content="Visualize your cycle patterns, symptom trends, and correlations. Non-diagnostic pattern detection powered by your own data.">
  <meta property="og:image" content="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=1200&h=630&fit=crop">
  <meta property="og:url" content="https://periodguide.com/insights.html">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Insights Dashboard — PeriodGuide">
  <meta name="twitter:description" content="Visualize your cycle patterns, symptom trends, and correlations.">

  <!-- Hreflang -->
  <link rel="alternate" hreflang="en" href="https://periodguide.com/insights.html">
  <link rel="alternate" hreflang="es" href="https://periodguide.com/es/insights.html">
  <link rel="alternate" hreflang="fr" href="https://periodguide.com/fr/insights.html">
  <link rel="alternate" hreflang="x-default" href="https://periodguide.com/insights.html">

  <link rel="canonical" href="https://periodguide.com/insights.html">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap" rel="stylesheet">

  <!-- Styles -->
  <link rel="stylesheet" href="styles/base.css">
  <link rel="stylesheet" href="styles/components.css">
  <link rel="stylesheet" href="styles/themes.css">

  <title>Insights Dashboard — PeriodGuide</title>

  <!-- Structured Data -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": "Insights Dashboard",
    "description": "Visualize your menstrual cycle patterns, symptom trends, and correlations with non-diagnostic pattern detection.",
    "url": "https://periodguide.com/insights.html",
    "isPartOf": {
      "@type": "WebApplication",
      "name": "PeriodGuide",
      "url": "https://periodguide.com",
      "applicationCategory": "HealthApplication",
      "operatingSystem": "Web",
      "offers": { "@type": "Offer", "price": "0", "priceCurrency": "USD" }
    },
    "breadcrumb": {
      "@type": "BreadcrumbList",
      "itemListElement": [
        { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://periodguide.com/" },
        { "@type": "ListItem", "position": 2, "name": "Insights Dashboard", "item": "https://periodguide.com/insights.html" }
      ]
    }
  }
  </script>

  <style>
    /* ===== Insights Dashboard Page Styles ===== */

    /* Hero */
    .insights-hero {
      position: relative;
      overflow: hidden;
      padding: var(--space-16) 0 var(--space-10);
      background: linear-gradient(135deg, #FFF0F3 0%, #F3F0FF 40%, #E3F2FD 100%);
    }
    [data-theme="dark"] .insights-hero {
      background: linear-gradient(135deg, #2A1520 0%, #221A3A 40%, #151A2E 100%);
    }
    @media (min-width: 768px) {
      .insights-hero { padding: var(--space-20) 0 var(--space-12); }
    }
    .insights-hero__blobs {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden;
    }
    .insights-hero__blobs .blob {
      position: absolute;
    }
    .insights-hero__blobs .blob:nth-child(1) {
      width: 350px; height: 350px;
      top: -80px; right: -60px;
      background: var(--color-secondary);
      opacity: 0.07;
    }
    .insights-hero__blobs .blob:nth-child(2) {
      width: 250px; height: 250px;
      bottom: -40px; left: -40px;
      background: var(--color-primary);
      opacity: 0.06;
    }
    .insights-hero__content {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-8);
      align-items: center;
    }
    @media (min-width: 1024px) {
      .insights-hero__content {
        grid-template-columns: 1fr 1fr;
        gap: var(--space-12);
      }
    }
    .insights-hero__text {
      text-align: center;
    }
    @media (min-width: 1024px) {
      .insights-hero__text { text-align: left; }
    }
    .insights-hero__title {
      font-family: var(--font-display);
      font-size: var(--text-4xl);
      font-weight: var(--weight-extrabold);
      line-height: 1.1;
      margin-bottom: var(--space-4);
      background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    @media (min-width: 768px) {
      .insights-hero__title { font-size: var(--text-5xl); }
    }
    .insights-hero__subtitle {
      font-size: var(--text-lg);
      color: var(--color-gray-600);
      max-width: 520px;
      margin: 0 auto var(--space-6);
      line-height: var(--leading-relaxed);
    }
    @media (min-width: 1024px) {
      .insights-hero__subtitle { margin: 0 0 var(--space-6); }
    }
    .insights-hero__disclaimer {
      display: inline-flex;
      align-items: center;
      gap: var(--space-2);
      padding: var(--space-2) var(--space-4);
      background: rgba(52, 152, 219, 0.1);
      border-radius: var(--radius-full);
      font-size: var(--text-sm);
      color: var(--color-info);
      font-weight: var(--weight-medium);
    }
    [data-theme="dark"] .insights-hero__disclaimer {
      background: rgba(52, 152, 219, 0.15);
    }
    .insights-hero__image {
      display: flex;
      justify-content: center;
    }
    .insights-hero__image img {
      width: 100%;
      max-width: 480px;
      height: auto;
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-xl);
    }

    /* Dashboard Tabs */
    .insights-tabs {
      display: flex;
      gap: var(--space-1);
      background: var(--color-gray-100);
      border-radius: var(--radius-full);
      padding: var(--space-1);
      max-width: 420px;
      margin: 0 auto var(--space-8);
    }
    @media (min-width: 768px) {
      .insights-tabs { margin: 0 auto var(--space-10); }
    }
    .insights-tab {
      flex: 1;
      padding: var(--space-2) var(--space-4);
      border: none;
      background: transparent;
      font-family: var(--font-primary);
      font-size: var(--text-sm);
      font-weight: var(--weight-semibold);
      color: var(--color-gray-600);
      border-radius: var(--radius-full);
      cursor: pointer;
      transition: all var(--transition-fast);
      text-align: center;
      white-space: nowrap;
      min-height: 40px;
    }
    .insights-tab:hover {
      color: var(--color-primary);
    }
    .insights-tab.active {
      background: var(--color-white);
      color: var(--color-primary);
      box-shadow: var(--shadow-sm);
    }
    .insights-tab-panel {
      display: none;
    }
    .insights-tab-panel.active {
      display: block;
      animation: fadeIn 0.4s ease;
    }

    /* Stats Overview Grid */
    .insights-stats {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: var(--space-4);
      margin-bottom: var(--space-8);
    }
    @media (min-width: 768px) {
      .insights-stats {
        grid-template-columns: repeat(4, 1fr);
        gap: var(--space-5);
      }
    }
    .insights-stat {
      background: var(--color-white);
      border-radius: var(--radius-xl);
      padding: var(--space-5) var(--space-4);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-gray-200);
      text-align: center;
      transition: all var(--transition-base);
      position: relative;
      overflow: hidden;
    }
    .insights-stat:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }
    .insights-stat::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
    }
    .insights-stat--days::before { background: linear-gradient(90deg, var(--color-primary), var(--color-secondary)); }
    .insights-stat--pain::before { background: var(--color-menstrual); }
    .insights-stat--mood::before { background: var(--color-secondary); }
    .insights-stat--energy::before { background: var(--color-follicular); }
    .insights-stat__icon {
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: var(--radius-lg);
      margin: 0 auto var(--space-3);
      font-size: 1.2rem;
    }
    .insights-stat--days .insights-stat__icon { background: var(--color-primary-pale); }
    .insights-stat--pain .insights-stat__icon { background: rgba(232, 93, 117, 0.1); }
    .insights-stat--mood .insights-stat__icon { background: var(--color-secondary-pale); }
    .insights-stat--energy .insights-stat__icon { background: rgba(86, 184, 112, 0.1); }
    .insights-stat__value {
      font-family: var(--font-display);
      font-size: var(--text-3xl);
      font-weight: var(--weight-extrabold);
      line-height: 1;
      margin-bottom: var(--space-1);
    }
    .insights-stat--days .insights-stat__value { color: var(--color-primary); }
    .insights-stat--pain .insights-stat__value { color: var(--color-menstrual); }
    .insights-stat--mood .insights-stat__value { color: var(--color-secondary); }
    .insights-stat--energy .insights-stat__value { color: var(--color-follicular); }
    .insights-stat__label {
      font-size: var(--text-sm);
      color: var(--color-gray-600);
      font-weight: var(--weight-medium);
    }

    /* Dashboard Cards */
    .insights-card {
      background: var(--color-white);
      border-radius: var(--radius-2xl);
      padding: var(--space-6);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--color-gray-200);
      margin-bottom: var(--space-6);
      transition: box-shadow var(--transition-base);
    }
    @media (min-width: 768px) {
      .insights-card { padding: var(--space-8); }
    }
    .insights-card:hover {
      box-shadow: var(--shadow-md);
    }
    .insights-card__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: var(--space-3);
      margin-bottom: var(--space-5);
    }
    .insights-card__title {
      font-family: var(--font-display);
      font-size: var(--text-xl);
      font-weight: var(--weight-bold);
      color: var(--color-black);
      margin: 0;
    }
    @media (min-width: 768px) {
      .insights-card__title { font-size: var(--text-2xl); }
    }
    .insights-card__badge {
      display: inline-flex;
      align-items: center;
      gap: var(--space-1);
      padding: var(--space-1) var(--space-3);
      background: var(--color-primary-pale);
      color: var(--color-primary);
      font-size: var(--text-xs);
      font-weight: var(--weight-semibold);
      border-radius: var(--radius-full);
    }

    /* Chart container */
    .insights-chart-wrap {
      min-height: 180px;
      position: relative;
    }
    .insights-chart-wrap--lg {
      min-height: 220px;
    }
    @media (min-width: 768px) {
      .insights-chart-wrap { min-height: 220px; }
      .insights-chart-wrap--lg { min-height: 280px; }
    }

    /* Sparkline grid */
    .sparkline-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-5);
    }
    @media (min-width: 640px) {
      .sparkline-grid { grid-template-columns: repeat(2, 1fr); }
    }
    @media (min-width: 1024px) {
      .sparkline-grid { grid-template-columns: repeat(4, 1fr); }
    }
    .sparkline-item {
      background: var(--color-gray-50);
      border-radius: var(--radius-xl);
      padding: var(--space-4);
      border: 1px solid var(--color-gray-200);
      transition: all var(--transition-base);
    }
    .sparkline-item:hover {
      border-color: var(--color-gray-300);
      box-shadow: var(--shadow-sm);
    }
    .sparkline-item__label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: var(--space-3);
    }
    .sparkline-item__name {
      font-size: var(--text-sm);
      font-weight: var(--weight-semibold);
      color: var(--color-black);
    }
    .sparkline-item__value {
      font-size: var(--text-sm);
      font-weight: var(--weight-bold);
    }
    .sparkline-item__chart {
      width: 100%;
      min-height: 50px;
    }

    /* Correlations section */
    .correlations-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-5);
    }
    @media (min-width: 768px) {
      .correlations-grid { grid-template-columns: repeat(2, 1fr); }
    }
    .correlation-card {
      display: flex;
      gap: var(--space-4);
      padding: var(--space-5);
      border-radius: var(--radius-xl);
      border: 1px solid var(--color-gray-200);
      background: var(--color-white);
      transition: all var(--transition-base);
    }
    .correlation-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-2px);
    }
    .correlation-card__icon {
      flex-shrink: 0;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.4rem;
      border-radius: var(--radius-lg);
    }
    .correlation-card__icon--sleep { background: rgba(52, 152, 219, 0.12); }
    .correlation-card__icon--stress { background: rgba(245, 166, 35, 0.12); }
    .correlation-card__icon--exercise { background: rgba(86, 184, 112, 0.12); }
    .correlation-card__icon--hydration { background: rgba(124, 92, 252, 0.12); }
    .correlation-card__body { flex: 1; }
    .correlation-card__title {
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
      color: var(--color-black);
      margin-bottom: var(--space-1);
    }
    .correlation-card__desc {
      font-size: var(--text-sm);
      color: var(--color-gray-600);
      line-height: var(--leading-relaxed);
      margin: 0;
    }

    /* Patterns section */
    .pattern-list {
      display: flex;
      flex-direction: column;
      gap: var(--space-4);
    }
    #patterns-container:empty::after {
      content: 'No patterns detected yet. Keep tracking to reveal insights.';
      display: block;
      text-align: center;
      padding: var(--space-6);
      color: var(--color-gray-500);
      font-size: var(--text-sm);
    }

    /* Suggestions section */
    .suggestions-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-4);
    }
    @media (min-width: 768px) {
      .suggestions-grid { grid-template-columns: repeat(3, 1fr); }
    }
    .suggestion-card {
      padding: var(--space-5);
      border-radius: var(--radius-xl);
      text-align: center;
      transition: all var(--transition-base);
      border: 1px solid var(--color-gray-200);
      background: var(--color-white);
    }
    .suggestion-card:hover {
      box-shadow: var(--shadow-md);
      transform: translateY(-3px);
    }
    .suggestion-card__icon {
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      border-radius: var(--radius-xl);
      margin: 0 auto var(--space-3);
    }
    .suggestion-card__title {
      font-size: var(--text-base);
      font-weight: var(--weight-semibold);
      color: var(--color-black);
      margin-bottom: var(--space-2);
    }
    .suggestion-card__desc {
      font-size: var(--text-sm);
      color: var(--color-gray-600);
      line-height: var(--leading-relaxed);
      margin: 0;
    }

    /* Insufficient data CTA */
    .insights-empty {
      text-align: center;
      padding: var(--space-12) var(--space-6);
      background: var(--color-white);
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-sm);
      border: 2px dashed var(--color-gray-300);
      max-width: 580px;
      margin: 0 auto var(--space-8);
    }
    .insights-empty__icon {
      width: 80px;
      height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto var(--space-4);
      background: var(--color-primary-pale);
      border-radius: var(--radius-full);
      font-size: 2rem;
    }
    .insights-empty__title {
      font-family: var(--font-display);
      font-size: var(--text-2xl);
      font-weight: var(--weight-bold);
      color: var(--color-black);
      margin-bottom: var(--space-3);
    }
    .insights-empty__desc {
      font-size: var(--text-base);
      color: var(--color-gray-600);
      line-height: var(--leading-relaxed);
      max-width: 420px;
      margin: 0 auto var(--space-6);
    }
    .insights-empty__progress {
      max-width: 280px;
      margin: 0 auto var(--space-4);
    }
    .insights-empty__progress-label {
      display: flex;
      justify-content: space-between;
      font-size: var(--text-xs);
      color: var(--color-gray-500);
      margin-bottom: var(--space-2);
    }

    /* Wellness image section */
    .insights-wellness {
      display: grid;
      grid-template-columns: 1fr;
      gap: var(--space-8);
      align-items: center;
    }
    @media (min-width: 1024px) {
      .insights-wellness { grid-template-columns: 1fr 1fr; }
    }
    .insights-wellness__img {
      width: 100%;
      height: 280px;
      object-fit: cover;
      border-radius: var(--radius-2xl);
      box-shadow: var(--shadow-lg);
    }
    @media (min-width: 768px) {
      .insights-wellness__img { height: 360px; }
    }
  </style>
</head>
<body>
  <!-- Skip Link -->
  <a href="#main" class="skip-link" data-i18n="skip_to_content">Skip to main content</a>

  <!-- Navigation -->
  <nav class="nav" role="navigation" aria-label="Main navigation">
    <div class="nav__inner">
      <a href="/" class="nav__logo" aria-label="PeriodGuide Home">
        <div class="nav__logo-icon" aria-hidden="true">P</div>
        <span>PeriodGuide</span>
      </a>

      <ul class="nav__links" role="menubar">
        <li role="none"><a href="/" role="menuitem" data-i18n="nav_home">Home</a></li>
        <li role="none"><a href="today.html" role="menuitem" data-i18n="nav_today">Today's Guide</a></li>
        <li role="none"><a href="cycle-day.html" role="menuitem" data-i18n="nav_cycle_day">Cycle Day</a></li>
        <li role="none"><a href="track.html" role="menuitem" data-i18n="nav_track">Track</a></li>
        <li role="none"><a href="insights.html" role="menuitem" class="active" data-i18n="nav_insights">Insights</a></li>
        <li role="none"><a href="toolkits/cramps.html" role="menuitem" data-i18n="nav_toolkits">Toolkits</a></li>
        <li role="none"><a href="traditions.html" role="menuitem" data-i18n="nav_traditions">Traditions</a></li>
      </ul>

      <div class="nav__actions">
        <div class="lang-switcher" role="group" aria-label="Language">
          <button class="lang-switcher__btn active" data-lang="en" aria-label="English">EN</button>
          <button class="lang-switcher__btn" data-lang="es" aria-label="Espa&#241;ol">ES</button>
          <button class="lang-switcher__btn" data-lang="fr" aria-label="Fran&#231;ais">FR</button>
        </div>
        <button class="theme-toggle" aria-label="Switch to dark mode">&#9790;</button>
        <button class="nav__mobile-toggle" aria-label="Open menu" aria-expanded="false">
          <span></span>
        </button>
      </div>
    </div>
  </nav>

  <!-- Mobile Menu -->
  <div class="mobile-menu" role="dialog" aria-label="Mobile navigation">
    <button class="mobile-menu__close" aria-label="Close menu">&times;</button>
    <ul class="mobile-menu__links">
      <li><a href="/" data-i18n="nav_home">Home</a></li>
      <li><a href="today.html" data-i18n="nav_today">Today's Guide</a></li>
      <li><a href="cycle-day.html" data-i18n="nav_cycle_day">Cycle Day</a></li>
      <li><a href="track.html" data-i18n="nav_track">Track</a></li>
      <li><a href="insights.html" class="active" data-i18n="nav_insights">Insights</a></li>
      <li><a href="toolkits/cramps.html" data-i18n="nav_toolkits">Toolkits</a></li>
      <li><a href="traditions.html" data-i18n="nav_traditions">Traditions</a></li>
      <li><a href="clinic-pack.html" data-i18n="nav_clinic_pack">Clinic Pack</a></li>
      <li><a href="privacy.html" data-i18n="nav_privacy">Privacy</a></li>
      <li><a href="about.html" data-i18n="nav_about">About</a></li>
    </ul>
    <div class="lang-switcher" style="margin-top:var(--space-6);justify-content:center;">
      <button class="lang-switcher__btn active" data-lang="en">EN</button>
      <button class="lang-switcher__btn" data-lang="es">ES</button>
      <button class="lang-switcher__btn" data-lang="fr">FR</button>
    </div>
  </div>

  <main id="main">

    <!-- ===== HERO SECTION ===== -->
    <section class="insights-hero" aria-labelledby="insights-heading">
      <div class="insights-hero__blobs" aria-hidden="true">
        <div class="blob"></div>
        <div class="blob"></div>
      </div>
      <div class="container">
        <div class="insights-hero__content">
          <div class="insights-hero__text">
            <h1 id="insights-heading" class="insights-hero__title" data-i18n="insights_title">Your Insights</h1>
            <p class="insights-hero__subtitle" data-i18n="insights_subtitle">See the patterns your body is telling you. Non-diagnostic trend detection based entirely on data you track -- stored locally, always yours.</p>
            <div class="insights-hero__disclaimer" role="note">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
              <span data-i18n="insights_not_medical">For awareness only. This is not a medical diagnosis.</span>
            </div>
          </div>
          <div class="insights-hero__image animate-on-scroll">
            <img src="https://images.unsplash.com/photo-1551288049-bebda4e38f71?w=800&h=600&fit=crop&auto=format"
              alt="Data visualization dashboard showing colorful analytics charts and trend lines"
              loading="eager" width="800" height="600">
          </div>
        </div>
      </div>
    </section>

    <!-- ===== INSUFFICIENT DATA MESSAGE ===== -->
    <section id="insights-empty-state" class="section" style="display:none;" aria-labelledby="empty-heading">
      <div class="container">
        <div class="insights-empty">
          <div class="insights-empty__icon" aria-hidden="true">
            <svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          </div>
          <h2 id="empty-heading" class="insights-empty__title" data-i18n="insights_need_data">Your Insights Are Waiting</h2>
          <p class="insights-empty__desc" data-i18n="insights_need_data_desc">Track at least 3 days to unlock your personal dashboard. The more you log, the richer your insights become.</p>
          <div class="insights-empty__progress">
            <div class="insights-empty__progress-label">
              <span data-i18n="insights_days_logged">Days logged</span>
              <span id="empty-days-count">0 / 3</span>
            </div>
            <div class="progress">
              <div class="progress__bar" id="empty-progress-bar" style="width:0%;" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="3" aria-label="Tracking progress"></div>
            </div>
          </div>
          <a href="track.html" class="btn btn--primary btn--lg" data-i18n="insights_start_tracking">Start Tracking Today</a>
          <p class="text-xs text-muted mt-4" data-i18n="insights_privacy_reminder">All data stays on your device. No account needed.</p>
        </div>
      </div>
    </section>

    <!-- ===== DASHBOARD CONTENT (shown when data exists) ===== -->
    <div id="insights-dashboard-content" style="display:none;">

      <!-- ===== STATS OVERVIEW ===== -->
      <section class="section" style="padding-bottom:0;" aria-labelledby="stats-heading">
        <div class="container">
          <h2 id="stats-heading" class="sr-only" data-i18n="insights_stats_overview">Statistics Overview</h2>
          <div class="insights-stats" role="list" aria-label="Your tracking statistics">
            <div class="insights-stat insights-stat--days" role="listitem">
              <div class="insights-stat__icon" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
              </div>
              <div class="insights-stat__value" id="stat-days-tracked" aria-live="polite">--</div>
              <div class="insights-stat__label" data-i18n="insights_days_tracked">Days Tracked</div>
            </div>
            <div class="insights-stat insights-stat--pain" role="listitem">
              <div class="insights-stat__icon" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-menstrual)" stroke-width="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>
              </div>
              <div class="insights-stat__value" id="stat-avg-pain" aria-live="polite">--</div>
              <div class="insights-stat__label" data-i18n="insights_avg_pain">Avg Pain</div>
            </div>
            <div class="insights-stat insights-stat--mood" role="listitem">
              <div class="insights-stat__icon" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-secondary)" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>
              </div>
              <div class="insights-stat__value" id="stat-avg-mood" aria-live="polite">--</div>
              <div class="insights-stat__label" data-i18n="insights_avg_mood">Avg Mood</div>
            </div>
            <div class="insights-stat insights-stat--energy" role="listitem">
              <div class="insights-stat__icon" aria-hidden="true">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-follicular)" stroke-width="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
              </div>
              <div class="insights-stat__value" id="stat-avg-energy" aria-live="polite">--</div>
              <div class="insights-stat__label" data-i18n="insights_avg_energy">Avg Energy</div>
            </div>
          </div>
        </div>
      </section>

      <!-- ===== TAB NAVIGATION ===== -->
      <section class="section" aria-label="Dashboard views">
        <div class="container">
          <div class="insights-tabs" role="tablist" aria-label="Insights views">
            <button class="insights-tab active" role="tab" id="tab-overview" aria-selected="true" aria-controls="panel-overview" data-i18n="insights_tab_overview">Overview</button>
            <button class="insights-tab" role="tab" id="tab-trends" aria-selected="false" aria-controls="panel-trends" data-i18n="insights_tab_trends">Trends</button>
            <button class="insights-tab" role="tab" id="tab-correlations" aria-selected="false" aria-controls="panel-correlations" data-i18n="insights_tab_correlations">Correlations</button>
          </div>

          <!-- ===== OVERVIEW TAB ===== -->
          <div class="insights-tab-panel active" id="panel-overview" role="tabpanel" aria-labelledby="tab-overview">

            <!-- Cycle Overview Chart -->
            <div class="insights-card" aria-labelledby="cycle-overview-heading">
              <div class="insights-card__header">
                <h3 id="cycle-overview-heading" class="insights-card__title" data-i18n="insights_cycle_overview">Cycle Overview</h3>
                <span class="insights-card__badge" data-i18n="insights_last_90">Last 90 days</span>
              </div>
              <p class="text-sm text-muted mb-4" data-i18n="insights_cycle_overview_desc">Average pain by cycle day, overlaid across all tracked cycles. See how symptoms shift throughout your cycle.</p>
              <div class="insights-chart-wrap insights-chart-wrap--lg" id="insights-cycle-overlay" role="img" aria-label="Cycle overlay chart showing pain levels across cycle days"></div>
            </div>

            <!-- Pattern Detection -->
            <div class="insights-card" aria-labelledby="patterns-heading">
              <div class="insights-card__header">
                <h3 id="patterns-heading" class="insights-card__title" data-i18n="insights_pattern_found">Pattern Detection</h3>
                <span class="insights-card__badge">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                  <span data-i18n="insights_non_diagnostic">Non-diagnostic</span>
                </span>
              </div>
              <p class="text-sm text-muted mb-4" data-i18n="insights_pattern_desc">Based on your logged data, here are patterns we have detected. These are observations, not diagnoses -- always consult a healthcare provider for medical concerns.</p>
              <div class="pattern-list" id="patterns-container" aria-live="polite"></div>
            </div>

            <!-- Try Next Cycle Suggestions -->
            <div class="insights-card" aria-labelledby="suggestions-heading">
              <div class="insights-card__header">
                <h3 id="suggestions-heading" class="insights-card__title" data-i18n="insights_try_next">Try Next Cycle</h3>
              </div>
              <p class="text-sm text-muted mb-6" data-i18n="insights_try_next_desc">Personalized suggestions based on your tracked patterns. Small changes can make a meaningful difference.</p>
              <div class="suggestions-grid" id="suggestions-container">
                <div class="suggestion-card animate-on-scroll">
                  <div class="suggestion-card__icon" style="background:rgba(52,152,219,0.1);" aria-hidden="true">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--color-info)" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                  </div>
                  <div class="suggestion-card__title" data-i18n="insights_sug_sleep">Prioritize Sleep Hygiene</div>
                  <p class="suggestion-card__desc" data-i18n="insights_sug_sleep_desc">Try a consistent bedtime during your luteal phase. Even 30 minutes earlier can improve mood and reduce pain sensitivity.</p>
                </div>
                <div class="suggestion-card animate-on-scroll">
                  <div class="suggestion-card__icon" style="background:rgba(86,184,112,0.1);" aria-hidden="true">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--color-follicular)" stroke-width="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
                  </div>
                  <div class="suggestion-card__title" data-i18n="insights_sug_hydrate">Track Hydration</div>
                  <p class="suggestion-card__desc" data-i18n="insights_sug_hydrate_desc">Adequate hydration can reduce bloating, headaches, and fatigue. Aim for 8 glasses and note the difference next cycle.</p>
                </div>
                <div class="suggestion-card animate-on-scroll">
                  <div class="suggestion-card__icon" style="background:rgba(232,93,117,0.1);" aria-hidden="true">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--color-primary)" stroke-width="2"><path d="M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z"/><line x1="4" y1="22" x2="4" y2="15"/></svg>
                  </div>
                  <div class="suggestion-card__title" data-i18n="insights_sug_movement">Gentle Movement Days</div>
                  <p class="suggestion-card__desc" data-i18n="insights_sug_movement_desc">On high-pain days, swap intense workouts for gentle walks, stretching, or yoga. Movement helps without overexertion.</p>
                </div>
              </div>
            </div>
          </div>

          <!-- ===== TRENDS TAB ===== -->
          <div class="insights-tab-panel" id="panel-trends" role="tabpanel" aria-labelledby="tab-trends">

            <!-- Symptom Trends with Sparklines -->
            <div class="insights-card" aria-labelledby="trends-heading">
              <div class="insights-card__header">
                <h3 id="trends-heading" class="insights-card__title" data-i18n="insights_symptom_trends">Symptom Trends</h3>
                <span class="insights-card__badge" data-i18n="insights_last_14">Last 14 days</span>
              </div>
              <p class="text-sm text-muted mb-6" data-i18n="insights_trends_desc">Track how your key metrics change day to day. Sparklines show the recent trajectory of each symptom.</p>
              <div class="sparkline-grid">
                <div class="sparkline-item">
                  <div class="sparkline-item__label">
                    <span class="sparkline-item__name" data-i18n="track_pain">Pain</span>
                    <span class="sparkline-item__value" id="trend-pain-avg" style="color:var(--color-menstrual);">--</span>
                  </div>
                  <div class="sparkline-item__chart" id="sparkline-pain" aria-label="Pain trend sparkline"></div>
                </div>
                <div class="sparkline-item">
                  <div class="sparkline-item__label">
                    <span class="sparkline-item__name" data-i18n="track_mood">Mood</span>
                    <span class="sparkline-item__value" id="trend-mood-avg" style="color:var(--color-secondary);">--</span>
                  </div>
                  <div class="sparkline-item__chart" id="sparkline-mood" aria-label="Mood trend sparkline"></div>
                </div>
                <div class="sparkline-item">
                  <div class="sparkline-item__label">
                    <span class="sparkline-item__name" data-i18n="track_energy">Energy</span>
                    <span class="sparkline-item__value" id="trend-energy-avg" style="color:var(--color-follicular);">--</span>
                  </div>
                  <div class="sparkline-item__chart" id="sparkline-energy" aria-label="Energy trend sparkline"></div>
                </div>
                <div class="sparkline-item">
                  <div class="sparkline-item__label">
                    <span class="sparkline-item__name" data-i18n="track_stress">Stress</span>
                    <span class="sparkline-item__value" id="trend-stress-avg" style="color:var(--color-warning);">--</span>
                  </div>
                  <div class="sparkline-item__chart" id="sparkline-stress" aria-label="Stress trend sparkline"></div>
                </div>
              </div>
            </div>

            <!-- Wellness context image + guidance -->
            <div class="insights-card">
              <div class="insights-wellness">
                <div class="animate-on-scroll">
                  <img src="https://images.unsplash.com/photo-1434494878577-86c23bcb06b9?w=800&auto=format"
                    alt="Person wearing fitness tracker on wrist during outdoor activity, representing personal wellness tracking"
                    class="insights-wellness__img" loading="lazy" width="800" height="533">
                </div>
                <div class="animate-on-scroll">
                  <h3 data-i18n="insights_trends_why_title">Why Trends Matter</h3>
                  <p class="text-muted" data-i18n="insights_trends_why_desc">Single days are snapshots. Trends tell the real story. By tracking consistently, you build a personal baseline that helps you notice when something shifts -- whether it is stress creeping up before your period, or energy dipping mid-cycle.</p>
                  <ul style="list-style:none;padding:0;margin:var(--space-4) 0 0;">
                    <li style="padding:var(--space-2) 0;display:flex;align-items:center;gap:var(--space-2);">
                      <span style="color:var(--color-success);font-weight:bold;" aria-hidden="true">&#10003;</span>
                      <span data-i18n="insights_trends_benefit_1">Identify your personal patterns over time</span>
                    </li>
                    <li style="padding:var(--space-2) 0;display:flex;align-items:center;gap:var(--space-2);">
                      <span style="color:var(--color-success);font-weight:bold;" aria-hidden="true">&#10003;</span>
                      <span data-i18n="insights_trends_benefit_2">Spot changes before they become problems</span>
                    </li>
                    <li style="padding:var(--space-2) 0;display:flex;align-items:center;gap:var(--space-2);">
                      <span style="color:var(--color-success);font-weight:bold;" aria-hidden="true">&#10003;</span>
                      <span data-i18n="insights_trends_benefit_3">Share meaningful data with your healthcare provider</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </div>

          <!-- ===== CORRELATIONS TAB ===== -->
          <div class="insights-tab-panel" id="panel-correlations" role="tabpanel" aria-labelledby="tab-correlations">

            <div class="insights-card" aria-labelledby="correlations-heading">
              <div class="insights-card__header">
                <h3 id="correlations-heading" class="insights-card__title" data-i18n="insights_correlations_title">Your Correlations</h3>
              </div>
              <p class="text-sm text-muted mb-6" data-i18n="insights_correlations_desc">Based on research and your tracked data, here are common connections between lifestyle factors and cycle symptoms. These are general patterns -- your individual experience may differ.</p>

              <div class="correlations-grid">
                <div class="correlation-card animate-on-scroll">
                  <div class="correlation-card__icon correlation-card__icon--sleep" aria-hidden="true">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--color-info)" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
                  </div>
                  <div class="correlation-card__body">
                    <div class="correlation-card__title" data-i18n="insights_corr_sleep_mood">Sleep &amp; Mood</div>
                    <p class="correlation-card__desc" data-i18n="insights_corr_sleep_mood_desc">Research consistently shows that poor sleep quality, especially in the luteal phase, correlates with lower mood, increased irritability, and heightened PMS symptoms. Aim for 7-9 hours.</p>
                  </div>
                </div>
                <div class="correlation-card animate-on-scroll">
                  <div class="correlation-card__icon correlation-card__icon--stress" aria-hidden="true">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--color-warning)" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                  </div>
                  <div class="correlation-card__body">
                    <div class="correlation-card__title" data-i18n="insights_corr_stress_pain">Stress &amp; Pain</div>
                    <p class="correlation-card__desc" data-i18n="insights_corr_stress_pain_desc">High stress elevates cortisol, which can amplify pain perception and worsen cramps. Stress management techniques like deep breathing, journaling, or gentle movement may reduce cycle pain.</p>
                  </div>
                </div>
                <div class="correlation-card animate-on-scroll">
                  <div class="correlation-card__icon correlation-card__icon--exercise" aria-hidden="true">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--color-follicular)" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
                  </div>
                  <div class="correlation-card__body">
                    <div class="correlation-card__title" data-i18n="insights_corr_exercise_energy">Exercise &amp; Energy</div>
                    <p class="correlation-card__desc" data-i18n="insights_corr_exercise_energy_desc">Moderate exercise during the follicular phase, when estrogen rises, often boosts energy and mood. During the luteal phase, gentler activity may feel more sustainable and still provide benefits.</p>
                  </div>
                </div>
                <div class="correlation-card animate-on-scroll">
                  <div class="correlation-card__icon correlation-card__icon--hydration" aria-hidden="true">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--color-secondary)" stroke-width="2"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
                  </div>
                  <div class="correlation-card__body">
                    <div class="correlation-card__title" data-i18n="insights_corr_hydration_bloating">Hydration &amp; Bloating</div>
                    <p class="correlation-card__desc" data-i18n="insights_corr_hydration_bloating_desc">Paradoxically, drinking more water can reduce water retention and bloating. Progesterone in the luteal phase promotes fluid retention, so consistent hydration helps counteract this effect.</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Personal correlation findings (rendered by JS) -->
            <div class="insights-card" aria-labelledby="personal-corr-heading">
              <div class="insights-card__header">
                <h3 id="personal-corr-heading" class="insights-card__title" data-i18n="insights_your_correlations">Your Personal Findings</h3>
                <span class="insights-card__badge">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                  <span data-i18n="insights_local_only">Local data only</span>
                </span>
              </div>
              <p class="text-sm text-muted mb-4" data-i18n="insights_your_correlations_desc">These findings are computed entirely from your own tracking data. Track more days for more accurate correlations.</p>
              <div id="personal-correlations-container" aria-live="polite">
                <p class="text-muted text-center p-4" data-i18n="insights_keep_tracking">Keep tracking to reveal your personal correlations.</p>
              </div>
            </div>
          </div>

        </div>
      </section>
    </div>

  </main>

  <!-- Footer -->
  <footer class="footer" role="contentinfo">
    <div class="container">
      <div class="footer__grid">
        <div class="footer__brand">
          <div class="footer__brand-name">PeriodGuide</div>
          <p class="footer__brand-desc" data-i18n="footer_tagline">Your cycle companion. Evidence-based. Privacy-first. Culturally respectful.</p>
          <div class="footer__privacy-badges">
            <span class="privacy-badge">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
              <span data-i18n="privacy_no_trackers">No ad trackers</span>
            </span>
            <span class="privacy-badge">
              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
              Anonymous-first
            </span>
          </div>
        </div>

        <div>
          <h4 class="footer__heading" data-i18n="footer_tools">Tools</h4>
          <ul class="footer__links">
            <li><a href="today.html" data-i18n="nav_today">Today's Guide</a></li>
            <li><a href="cycle-day.html" data-i18n="nav_cycle_day">Cycle Day Finder</a></li>
            <li><a href="track.html" data-i18n="nav_track">Symptom Tracker</a></li>
            <li><a href="insights.html" data-i18n="nav_insights">Insights</a></li>
            <li><a href="clinic-pack.html" data-i18n="nav_clinic_pack">Clinic Pack</a></li>
          </ul>
        </div>

        <div>
          <h4 class="footer__heading" data-i18n="footer_resources">Resources</h4>
          <ul class="footer__links">
            <li><a href="toolkits/cramps.html" data-i18n="toolkit_cramps_title">Cramps Toolkit</a></li>
            <li><a href="toolkits/pms-pmdd.html" data-i18n="toolkit_pms_title">PMS &amp; PMDD</a></li>
            <li><a href="traditions.html" data-i18n="nav_traditions">Traditions Library</a></li>
          </ul>
        </div>

        <div>
          <h4 class="footer__heading" data-i18n="footer_company">Company</h4>
          <ul class="footer__links">
            <li><a href="about.html" data-i18n="nav_about">About</a></li>
            <li><a href="privacy.html" data-i18n="nav_privacy">Privacy</a></li>
            <li><a href="accessibility.html" data-i18n="nav_accessibility">Accessibility</a></li>
          </ul>
        </div>
      </div>

      <div class="footer__bottom">
        <p class="footer__copy">&copy; 2025 <span data-i18n="footer_copyright">PeriodGuide.com. All rights reserved.</span></p>
        <p class="text-sm" data-i18n="safety_red_flag_disclaimer">This is not medical advice. If you're concerned, contact a healthcare provider.</p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/i18n.js"></script>
  <script src="js/app.js"></script>
  <script src="js/cycle-tracker.js"></script>
  <script src="js/guidance.js"></script>
  <script src="js/tracking.js"></script>
  <script src="js/insights.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      // --- Fetch stats and decide which view to show ---
      const stats = PG_TRACKING.getStats(90);
      const emptyState = document.getElementById('insights-empty-state');
      const dashboardContent = document.getElementById('insights-dashboard-content');

      if (!stats || stats.totalEntries < 3) {
        // Show insufficient data state
        emptyState.style.display = 'block';
        dashboardContent.style.display = 'none';

        // Update progress indicator
        const count = stats ? stats.totalEntries : 0;
        const countEl = document.getElementById('empty-days-count');
        const barEl = document.getElementById('empty-progress-bar');
        if (countEl) countEl.textContent = count + ' / 3';
        if (barEl) {
          const pct = Math.min(100, Math.round((count / 3) * 100));
          barEl.style.width = pct + '%';
          barEl.setAttribute('aria-valuenow', count);
        }
        return;
      }

      // --- Show full dashboard ---
      emptyState.style.display = 'none';
      dashboardContent.style.display = 'block';

      // Populate stat cards
      document.getElementById('stat-days-tracked').textContent = stats.totalEntries;
      document.getElementById('stat-avg-pain').textContent = stats.avgPain;
      document.getElementById('stat-avg-mood').textContent = stats.avgMood;
      document.getElementById('stat-avg-energy').textContent = stats.avgEnergy;

      // Fetch entries
      const entries = PG_TRACKING.getEntriesForRange(90);
      const recentEntries = PG_TRACKING.getEntriesForRange(14);

      // --- Render Cycle Overlay chart ---
      const overlayEl = document.getElementById('insights-cycle-overlay');
      if (overlayEl) {
        PG_INSIGHTS.renderCycleOverlay(overlayEl, entries);
      }

      // --- Render sparklines ---
      requestAnimationFrame(() => {
        const painVals = recentEntries.map(e => e.pain || 0);
        const moodVals = recentEntries.map(e => e.mood || 5);
        const energyVals = recentEntries.map(e => e.energy || 5);
        const stressVals = recentEntries.map(e => e.stress || 3);

        const painSpark = document.getElementById('sparkline-pain');
        const moodSpark = document.getElementById('sparkline-mood');
        const energySpark = document.getElementById('sparkline-energy');
        const stressSpark = document.getElementById('sparkline-stress');

        if (painSpark && painVals.length) PG_INSIGHTS.renderSparkline(painSpark, painVals, 'var(--color-menstrual)');
        if (moodSpark && moodVals.length) PG_INSIGHTS.renderSparkline(moodSpark, moodVals, 'var(--color-secondary)');
        if (energySpark && energyVals.length) PG_INSIGHTS.renderSparkline(energySpark, energyVals, 'var(--color-follicular)');
        if (stressSpark && stressVals.length) PG_INSIGHTS.renderSparkline(stressSpark, stressVals, 'var(--color-warning)');

        // Trend averages
        const avg = (arr) => arr.length ? (arr.reduce((a, b) => a + b, 0) / arr.length).toFixed(1) : '--';
        document.getElementById('trend-pain-avg').textContent = avg(painVals);
        document.getElementById('trend-mood-avg').textContent = avg(moodVals);
        document.getElementById('trend-energy-avg').textContent = avg(energyVals);
        document.getElementById('trend-stress-avg').textContent = avg(stressVals);
      });

      // --- Pattern Detection ---
      const patterns = PG_INSIGHTS.detectPatterns(entries);
      const patternsContainer = document.getElementById('patterns-container');
      if (patternsContainer && patterns.length) {
        const lang = typeof PG_I18N !== 'undefined' ? PG_I18N.getLang() : 'en';
        patternsContainer.innerHTML = patterns.map(p => `
          <div class="alert alert--${p.severity === 'attention' ? 'warning' : 'info'}">
            <div class="alert__icon" aria-hidden="true">${p.severity === 'attention' ? '&#9888;' : '&#8505;'}</div>
            <div class="alert__content">
              <div class="alert__title">${p['title_' + lang] || p.title_en}</div>
              <p style="margin:0;">${p['desc_' + lang] || p.desc_en}</p>
            </div>
          </div>
        `).join('');
      }

      // --- Personal Correlations ---
      const personalContainer = document.getElementById('personal-correlations-container');
      if (personalContainer && entries.length >= 7) {
        const lang = typeof PG_I18N !== 'undefined' ? PG_I18N.getLang() : 'en';
        const withSleepMood = entries.filter(e => e.sleep > 0 && e.mood > 0);
        const withStressPain = entries.filter(e => e.stress > 0 && e.pain > 0);
        const findings = [];

        if (withSleepMood.length >= 5) {
          const lowSleepBadMood = withSleepMood.filter(e => e.sleep < 6 && e.mood < 4).length;
          const ratio = lowSleepBadMood / withSleepMood.length;
          if (ratio > 0.25) {
            findings.push({
              icon: '&#9790;',
              cls: 'info',
              title: { en: 'Sleep affects your mood', es: 'El sueno afecta tu animo', fr: 'Le sommeil affecte votre humeur' },
              desc: { en: `On ${Math.round(ratio * 100)}% of low-sleep days, your mood was also low. Better sleep may improve your cycle experience.`, es: `En ${Math.round(ratio * 100)}% de los dias con poco sueno, tu animo tambien fue bajo.`, fr: `Sur ${Math.round(ratio * 100)}% des jours de faible sommeil, votre humeur etait aussi basse.` }
            });
          }
        }

        if (withStressPain.length >= 5) {
          const highStressHighPain = withStressPain.filter(e => e.stress >= 6 && e.pain >= 5).length;
          const ratio = highStressHighPain / withStressPain.length;
          if (ratio > 0.25) {
            findings.push({
              icon: '&#9888;',
              cls: 'warning',
              title: { en: 'Stress amplifies your pain', es: 'El estres amplifica tu dolor', fr: 'Le stress amplifie votre douleur' },
              desc: { en: `On ${Math.round(ratio * 100)}% of high-stress days, your pain was elevated. Stress-reduction practices may help during your cycle.`, es: `En ${Math.round(ratio * 100)}% de los dias de alto estres, tu dolor fue elevado.`, fr: `Sur ${Math.round(ratio * 100)}% des jours de stress eleve, votre douleur etait elevee.` }
            });
          }
        }

        if (findings.length) {
          personalContainer.innerHTML = findings.map(f => `
            <div class="alert alert--${f.cls} mb-4">
              <div class="alert__icon" aria-hidden="true">${f.icon}</div>
              <div class="alert__content">
                <div class="alert__title">${f.title[lang] || f.title.en}</div>
                <p style="margin:0;">${f.desc[lang] || f.desc.en}</p>
              </div>
            </div>
          `).join('');
        }
      }

      // --- Tab switching ---
      const tabs = document.querySelectorAll('.insights-tab');
      const panels = document.querySelectorAll('.insights-tab-panel');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => {
            t.classList.remove('active');
            t.setAttribute('aria-selected', 'false');
          });
          panels.forEach(p => p.classList.remove('active'));

          tab.classList.add('active');
          tab.setAttribute('aria-selected', 'true');
          const panelId = tab.getAttribute('aria-controls');
          const panel = document.getElementById(panelId);
          if (panel) panel.classList.add('active');

          // Re-render sparklines when trends tab is opened (ensures correct widths)
          if (panelId === 'panel-trends') {
            requestAnimationFrame(() => {
              const painVals = recentEntries.map(e => e.pain || 0);
              const moodVals = recentEntries.map(e => e.mood || 5);
              const energyVals = recentEntries.map(e => e.energy || 5);
              const stressVals = recentEntries.map(e => e.stress || 3);

              const ps = document.getElementById('sparkline-pain');
              const ms = document.getElementById('sparkline-mood');
              const es = document.getElementById('sparkline-energy');
              const ss = document.getElementById('sparkline-stress');

              if (ps && painVals.length) PG_INSIGHTS.renderSparkline(ps, painVals, 'var(--color-menstrual)');
              if (ms && moodVals.length) PG_INSIGHTS.renderSparkline(ms, moodVals, 'var(--color-secondary)');
              if (es && energyVals.length) PG_INSIGHTS.renderSparkline(es, energyVals, 'var(--color-follicular)');
              if (ss && stressVals.length) PG_INSIGHTS.renderSparkline(ss, stressVals, 'var(--color-warning)');
            });
          }
        });

        // Keyboard accessibility for tabs
        tab.addEventListener('keydown', (e) => {
          const tabsArr = Array.from(tabs);
          const idx = tabsArr.indexOf(tab);
          let newIdx;

          if (e.key === 'ArrowRight' || e.key === 'ArrowDown') {
            e.preventDefault();
            newIdx = (idx + 1) % tabsArr.length;
          } else if (e.key === 'ArrowLeft' || e.key === 'ArrowUp') {
            e.preventDefault();
            newIdx = (idx - 1 + tabsArr.length) % tabsArr.length;
          } else if (e.key === 'Home') {
            e.preventDefault();
            newIdx = 0;
          } else if (e.key === 'End') {
            e.preventDefault();
            newIdx = tabsArr.length - 1;
          }

          if (newIdx !== undefined) {
            tabsArr[newIdx].focus();
            tabsArr[newIdx].click();
          }
        });
      });

      // --- Also call the built-in renderInsightsDashboard for any dynamic content ---
      // (This is a secondary render pass; the page already has structured markup above)
      // PG_INSIGHTS.renderInsightsDashboard can be used for a simpler single-container approach.
    });
  </script>
</body>
</html>
